<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è–©è«¾ç“¦ç¾©å¼å»šæˆ¿</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      --brand-green: #2c5e50;
      --brand-red: #D32F2F;
      --bg-color: #fcfbf9;
    }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", Roboto, sans-serif; 
      background-color: var(--bg-color); 
      margin: 0; padding: 0; overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .input-field { @apply w-full p-3 border rounded-xl bg-white focus:ring-2 focus:ring-green-700 outline-none transition-all; }
    .label-text { @apply text-xs font-bold text-gray-500 mb-1 block uppercase tracking-wider; }
  </style>

  <script type="module">
    import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

    const LIFF_ID = "2008861231-EA0Hpl68";
    const RESTAURANT_NAME = "è–©è«¾ç“¦ç¾©å¼å»šæˆ¿";
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxHOJOzIGqCnW-ttjB0_OeJ6eIz3iqF3dnYSwGeK4L2vRi6dEuWZ-i_DoM5pHjz9u7PlA/exec";

    const runGAS = async (action, params = {}) => {
      try {
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action, ...params })
        });
        return await response.json();
      } catch (err) {
        return { status: 'error', message: 'é€£ç·šå¤±æ•—' };
      }
    };

    const Icon = ({ name, className }) => {
      const paths = {
        menu: "M4 6h16M4 12h16M4 18h16",
        calendar: "M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zm0 0V2m-14 2V2",
        map: "M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",
        user: "M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2 M12 11a4 4 0 100-8 4 4 0 000 8z",
        gift: "M20 12v10H4V12 M2 7h20v5H2z M12 22V7",
        back: "M15 19l-7-7 7-7",
        phone: "M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07",
        star: "M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z",
        download: "M4 17v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 11l5 5 5-5M12 4v12",
        close: "M6 18L18 6M6 6l12 12",
        trash: "M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6",
        edit: "M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7m-4-6l.5-2.5 2.5.5L18 8.5l-5 5-3.5-1.5L14 4.5z",
        cart: "M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z",
        question: "M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4 0 .742-.215 1.42-.588 2H12v2h3.535a4.004 4.004 0 01-7.07 0H5V9h3.228zM12 4a8 8 0 100 16 8 8 0 000-16z",
        info: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
        ticket: "M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z",
        history: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
        stamp: "M5 5a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2H7a2 2 0 01-2-2V5z"
      };
      return React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: "2" },
        React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: paths[name] || "" })
      );
    };

    const App = () => {
      const [view, setView] = useState('HOME');
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState({ member: null, faqs: [], promotions: [] });
      const [profile, setProfile] = useState(null);
      const [currentBookingId, setCurrentBookingId] = useState(null);
      
      const handleMemberUpdate = (member) => setData(prev => ({ ...prev, member }));
      const handleMemberDelete = () => setData(prev => ({...prev, member: null}));
      const handleBookingSuccess = (bookingId) => {
        setCurrentBookingId(bookingId);
        setView('PREORDER');
      };

      useEffect(() => {
        const init = async () => {
          let currentUserId = '';
          try {
            if (window.liff) {
              await window.liff.init({ liffId: LIFF_ID });
              if (window.liff.isLoggedIn()) {
                const p = await window.liff.getProfile();
                setProfile(p);
                currentUserId = p.userId;
              }
            }
          } catch (e) { console.warn("LIFF init failed"); }

          const res = await runGAS('getInitialData', { lineUserId: currentUserId });
          if (res.status === 'success') setData(res);
          setLoading(false);
        };
        init();
      }, []);

      if (loading) return (
        React.createElement("div", { className: "fixed inset-0" },
          React.createElement("img", { src: "https://i.ibb.co/93NGBjjh/IMG-6773.jpg", className: "w-full h-full object-cover" })
        )
      );

      const BaseView = ({ title, children, onBack }) => (
        React.createElement("div", { className: "flex flex-col h-screen bg-white animate-fade-in" },
          React.createElement("div", { className: "bg-[#2c5e50] text-white p-4 flex items-center shadow-md h-14 shrink-0" },
            React.createElement("button", { onClick: onBack, className: "mr-3 p-1" }, React.createElement(Icon, { name: "back", className: "w-6 h-6" })),
            React.createElement("h2", { className: "text-lg font-bold" }, title)
          ),
          React.createElement("div", { className: "flex-1 overflow-y-auto" }, children)
        )
      );
      
      const goHome = () => setView('HOME');

      switch(view) {
        case 'HOME': return React.createElement(HomeView, { setView, profile, data });
        case 'MENU': return React.createElement(BaseView, { title: "ç²¾ç·»èœå–®", onBack: goHome }, React.createElement(MenuView));
        case 'LOCATION': return React.createElement(BaseView, { title: "åº—å®¶è³‡è¨Š", onBack: goHome }, React.createElement(LocationView, { profile }));
        case 'NEWS': return React.createElement(BaseView, { title: "æ´»å‹•èˆ‡å„ªæƒ ", onBack: goHome }, React.createElement(NewsView, { promotions: data.promotions }));
        case 'FAQ': return React.createElement(BaseView, { title: "å¸¸è¦‹å•é¡Œ", onBack: goHome }, React.createElement(FaqView, { faqs: data.faqs }));
        case 'BOOKING': return React.createElement(BaseView, { title: "ç·šä¸Šè¨‚ä½", onBack: goHome }, React.createElement(BookingView, { member: data.member, profile, onBack: goHome, onBookingSuccess: handleBookingSuccess }));
        case 'MEMBER': return React.createElement(BaseView, { title: "æœƒå“¡ä¸­å¿ƒ", onBack: goHome }, React.createElement(MemberView, { member: data.member, profile, onMemberUpdate: handleMemberUpdate, onMemberDelete: handleMemberDelete, setView }));
        case 'PREORDER': return React.createElement(BaseView, { title: "é å…ˆé»é¤", onBack: goHome }, React.createElement(PreorderView, { bookingId: currentBookingId, onBack: goHome }));
        case 'MY_BOOKINGS': return React.createElement(BaseView, { title: "æˆ‘çš„è¨‚ä½", onBack: () => setView('MEMBER') }, React.createElement(MyBookingsView, { profile }));
        case 'POINT_HISTORY': return React.createElement(BaseView, { title: "é»æ•¸ç´€éŒ„", onBack: () => setView('MEMBER') }, React.createElement(PointHistoryView, { profile }));
        case 'COUPONS': return React.createElement(BaseView, { title: "æˆ‘çš„å„ªæƒ åˆ¸", onBack: () => setView('MEMBER') }, React.createElement(CouponsView, { profile }));
        case 'STAMP_CARD': return React.createElement(BaseView, { title: "é›†é»å¡", onBack: () => setView('MEMBER') }, React.createElement(StampCardView, { profile }));
        default: return React.createElement(HomeView, { setView, profile, data });
      }
    };

    const HomeView = ({ setView, profile, data }) => (
      React.createElement("div", { className: "flex flex-col h-full bg-gradient-to-b from-green-50 to-white" },
        React.createElement("div", { className: "bg-white p-4 sticky top-0 z-10 flex justify-between items-center shadow-sm h-14 shrink-0" },
          React.createElement("h1", { className: "font-bold text-[#2c5e50] text-sm" }, 
            profile?.displayName ? `${profile.displayName}, æ­¡è¿å…‰è‡¨` : RESTAURANT_NAME
          ),
          profile && React.createElement("img", { src: profile.pictureUrl, className: "w-8 h-8 rounded-full border border-[#2c5e50]" })
        ),
        React.createElement("div", { className: "flex-1 overflow-y-auto p-5 space-y-6" },
          React.createElement("div", { className: "relative h-48 rounded-2xl overflow-hidden shadow-xl" },
            React.createElement("img", { src: "https://i.ibb.co/qLFg7gSk/Gemini-Generated-Image-cmj4yzcmj4yzcmj4.png", className: "w-full h-full object-cover" }),
            React.createElement("div", { className: "absolute inset-0 bg-gradient-to-t from-black/80 flex items-end p-5 text-white" },
              React.createElement("div", null,
                React.createElement("h3", { className: "font-bold text-xl" }, "Buongiorno!"),
                React.createElement("p", { className: "text-[10px] opacity-80 uppercase tracking-widest font-bold" }, "é‡‘é–€é“åœ°ç¾©å¤§åˆ©é¢¨å‘³")
              )
            )
          ),
          React.createElement("div", { className: "grid grid-cols-2 gap-4" },
            [
              { id: 'MENU', name: 'ç²¾ç·»èœå–®', icon: 'menu', color: 'orange' },
              { id: 'BOOKING', name: 'ç·šä¸Šè¨‚ä½', icon: 'calendar', color: 'green' },
              { id: 'LOCATION', name: 'åº—å®¶è³‡è¨Š', icon: 'map', color: 'blue' },
              { id: 'MEMBER', name: 'æœƒå“¡ä¸­å¿ƒ', icon: 'user', color: 'purple' },
              { id: 'NEWS', name: 'æ´»å‹•å„ªæƒ ', icon: 'gift', color: 'red' },
              { id: 'FAQ', name: 'å¸¸è¦‹å•é¡Œ', icon: 'question', color: 'gray' }
            ].map(btn => (
              React.createElement("button", { key: btn.id, onClick: () => setView(btn.id), className: "h-32 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-md border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition-all relative" },
                React.createElement("div", { className: `w-12 h-12 bg-${btn.color}-50 rounded-full flex items-center justify-center text-${btn.color}-600`}, React.createElement(Icon, { name: btn.icon, className: "w-6 h-6" })),
                React.createElement("span", { className: "font-bold text-gray-700 text-sm" }, btn.name)
              )
            ))
          )
        )
      )
    );
    
    const MenuView = () => {
        const [modalItem, setModalItem] = useState(null);
        const menuItems = [
            { src: "https://i.ibb.co/QFTKgJ1B/2023-03-25.webp", label: "èœå–®æ­£é¢", filename: "sanova-menu-front.webp" },
            { src: "https://i.ibb.co/hJ6cfgjM/2025-12-28.webp", label: "èœå–®èƒŒé¢", filename: "sanova-menu-back.webp" }
        ];
        return React.createElement(React.Fragment, null,
            React.createElement("div", { className: "p-6 space-y-8" },
                menuItems.map(item =>
                    React.createElement("div", { key: item.src, className: "text-center" },
                        React.createElement("p", { className: "font-bold text-gray-600 mb-2 text-sm" }, item.label),
                        React.createElement("img", {
                            src: item.src,
                            className: "w-full rounded-lg shadow-lg cursor-pointer transition-transform hover:scale-105 duration-300",
                            onClick: () => setModalItem(item)
                        })
                    )
                )
            ),
            modalItem && React.createElement("div", {
                    className: "fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-50 animate-fade-in p-4",
                    onClick: () => setModalItem(null)
                },
                React.createElement("button", {
                    className: "absolute top-5 right-5 bg-white/20 backdrop-blur-sm text-white rounded-full p-2 hover:bg-white/30 transition-all z-20",
                    onClick: () => setModalItem(null)
                }, React.createElement(Icon, { name: "close", className: "w-7 h-7" })),
                React.createElement("div", {
                        className: "flex flex-col items-center",
                        onClick: e => e.stopPropagation()
                    },
                    React.createElement("img", {
                        src: modalItem.src,
                        className: "max-w-full max-h-[75vh] rounded-lg shadow-2xl object-contain"
                    }),
                    React.createElement("a", {
                        href: modalItem.src,
                        download: modalItem.filename,
                        className: "mt-4 inline-flex items-center justify-center gap-2 bg-[#2c5e50] text-white px-5 py-3 rounded-lg text-sm font-bold shadow-md hover:bg-opacity-90 transition-all"
                    }, React.createElement(Icon, { name: "download", className: "w-5 h-5" }), "ä¸‹è¼‰èœå–®")
                )
            )
        );
    };

    const LocationView = ({ profile }) => {
        const [showFeedback, setShowFeedback] = useState(false);
        const [rating, setRating] = useState(0);
        const [comment, setComment] = useState("");
        const [submitting, setSubmitting] = useState(false);

        const handleSubmitFeedback = async () => {
            if (rating === 0) {
                Swal.fire({ icon: 'warning', title: 'è«‹çµ¦æ˜Ÿç´šè©•åˆ†', text: 'è«‹è‡³å°‘é¸æ“‡ä¸€é¡†æ˜Ÿ', confirmButtonColor: '#D32F2F' });
                return;
            }
            setSubmitting(true);
            const res = await runGAS('submitFeedback', { lineUserId: profile?.userId, name: profile?.displayName, rating, comment });
            if (res.status === 'success') {
                Swal.fire('æ„Ÿè¬æ‚¨çš„å›é¥‹ï¼', 'æ‚¨çš„æ„è¦‹æ˜¯æˆ‘å€‘é€²æ­¥çš„å‹•åŠ›', 'success');
                setShowFeedback(false); setRating(0); setComment("");
            } else {
                Swal.fire({ icon: 'error', title: 'æäº¤å¤±æ•—', text: res.message, confirmButtonColor: '#D32F2F' });
            }
            setSubmitting(false);
        };

        return React.createElement("div", { className: "p-6 space-y-6" },
            React.createElement("iframe", { 
                src: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3637.362799307897!2d118.4232238759325!3d24.43851537832669!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x34152b1b31278881%3A0xb355205561237a3!2z6JOu6K2v55m-576p5byD55m-5a62!5e0!3m2!1szh-TW!2stw!4v1716962838382!5m2!1szh-TW!2stw", 
                className: "w-full h-64 rounded-xl border-0 shadow-md", allowFullScreen: "", loading: "lazy", referrerPolicy: "no-referrer-when-downgrade" 
            }),
            React.createElement("div", { className: "space-y-4" },
                React.createElement("div", { className: "flex gap-4 items-start" }, React.createElement(Icon, { name: "map", className: "w-6 h-6 text-[#2c5e50] shrink-0 mt-1" }), React.createElement("div", null, React.createElement("h4", { className: "font-bold" }, "é¤å»³åœ°å€"), React.createElement("p", { className: "text-gray-600" }, "é‡‘é–€ç¸£é‡‘æ¹–é®å¤ªæ¹–è·¯äºŒæ®µ3å··6è™Ÿ"))),
                React.createElement("div", { className: "flex gap-4 items-start" }, React.createElement(Icon, { name: "phone", className: "w-6 h-6 text-[#2c5e50] shrink-0 mt-1" }), React.createElement("div", null, React.createElement("h4", { className: "font-bold" }, "è¯çµ¡é›»è©±"), React.createElement("p", { className: "text-gray-600" }, "082-332530")))
            ),
             React.createElement("div", { className: "bg-blue-50 p-4 rounded-xl border border-blue-200" },
                React.createElement("h4", { className: "font-bold text-gray-800 mb-2" }, "äº¤é€šè³‡è¨Š"),
                React.createElement("p", { className: "text-sm text-gray-600" }, "ğŸš— é™„è¿‘è¨­æœ‰å…¬å…±åœè»Šå ´ï¼Œæ­¥è¡Œç´„5åˆ†é˜ã€‚"),
                React.createElement("p", { className: "text-sm text-gray-600 mt-1" }, "ğŸšŒ å¯æ­ä¹˜å…¬è»Šè‡³ã€Œå¤ªæ¹–ç«™ã€ï¼Œæ­¥è¡Œç´„3åˆ†é˜ã€‚")
            ),
            !showFeedback ? 
                React.createElement("button", { onClick: () => setShowFeedback(true), className: "w-full bg-yellow-500 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2" }, React.createElement(Icon, {name:"star", className:"w-5 h-5"}), "é»æˆ‘ç•™ä¸‹é¡§å®¢å›é¥‹")
                :
                React.createElement("div", { className: "p-4 bg-white rounded-xl shadow-md border animate-fade-in" },
                    React.createElement("h3", { className: "font-bold text-gray-700 mb-2" }, "æ‚¨çš„å¯¶è²´æ„è¦‹"),
                    React.createElement("div", { className: "flex justify-center my-4" }, 
                        [1, 2, 3, 4, 5].map(star => React.createElement("button", { key: star, onClick: () => setRating(star) }, React.createElement(Icon, { name: "star", className: `w-8 h-8 ${rating >= star ? 'text-yellow-400 fill-current' : 'text-gray-300'}` })))
                    ),
                    React.createElement("textarea", { value: comment, onChange: e => setComment(e.target.value), className: "input-field", placeholder: "è«‹åˆ†äº«æ‚¨çš„ç”¨é¤é«”é©—...", rows: 3 }),
                    React.createElement("div", { className: "flex gap-2 mt-2" },
                        React.createElement("button", { onClick: handleSubmitFeedback, disabled: submitting, className: "w-full bg-green-600 text-white py-2 rounded-lg disabled:bg-gray-400" }, submitting ? "å‚³é€ä¸­..." : "é€å‡º"),
                        React.createElement("button", { onClick: () => setShowFeedback(false), className: "w-full bg-gray-200 py-2 rounded-lg" }, "å–æ¶ˆ")
                    )
                )
        );
    };

    const NewsView = ({ promotions }) => (
        React.createElement("div", { className: "p-4 space-y-4" },
            promotions.length === 0 ? React.createElement("p", {className: "text-center text-gray-500 mt-8"}, "ç›®å‰æ²’æœ‰ä»»ä½•æ´»å‹•èˆ‡å„ªæƒ ã€‚") :
            promotions.map((p, i) => React.createElement("div", { key: i, className: "bg-white rounded-xl shadow-md border overflow-hidden" },
                p.åœ–ç‰‡ç¶²å€ && React.createElement("img", { src: p.åœ–ç‰‡ç¶²å€, className: "w-full h-44 object-cover" }),
                React.createElement("div", { className: "p-4" },
                    p.é¡å‹ === 'æ´»å‹•' && React.createElement("div", { className: "text-sm text-red-600 font-bold mb-1 flex items-center gap-1" }, React.createElement(Icon, {name:"calendar", className:"w-4 h-4"}), `æ´»å‹•æ—¥æœŸï¼š${new Date(p.æ´»å‹•æ—¥æœŸ).toLocaleDateString()}`),
                    React.createElement("h3", { className: "font-bold text-green-800" }, p.æ¨™é¡Œ),
                    React.createElement("p", { className: "text-sm text-gray-500 mt-1" }, p.å…§å®¹)
                )
            ))
        )
    );

    const FaqView = ({ faqs }) => (
        React.createElement("div", { className: "p-4 space-y-3" },
          faqs.length === 0 ? React.createElement("p", {className: "text-center text-gray-500 mt-8"}, "ç›®å‰æ²’æœ‰å¸¸è¦‹å•é¡Œã€‚") :
          faqs.map((f, i) => React.createElement("details", { key: i, className: "bg-gray-50 rounded-xl border p-4 group" }, 
            React.createElement("summary", { className: "font-bold cursor-pointer flex justify-between items-center" }, f.å•é¡Œ, React.createElement(Icon, { name: "back", className: "w-4 h-4 -rotate-90 group-open:rotate-90 transition-transform" })), 
            React.createElement("p", { className: "text-sm text-gray-600 mt-2 pt-2 border-t" }, f.å›ç­”)
          ))
        )
    );

    const BookingView = ({ member, profile, onBack, onBookingSuccess }) => {
        const [form, setForm] = useState({ date: new Date().toISOString().split('T')[0], time: '12:00', adults: 2, children: 0, highChairs: 0, name: member?.name || profile?.displayName || '', phone: member?.phone || '', notes: '', vegetarian: false, seating: 'ä¸æŒ‡å®š', occasion: 'ç„¡' });
        const [submitting, setSubmitting] = useState(false);

        useEffect(() => {
            if (form.highChairs > form.children) {
                setForm(prev => ({ ...prev, highChairs: prev.children }));
            }
        }, [form.children, form.highChairs]);

        const handleDateChange = (e) => {
            const newDate = e.target.value;
            const day = new Date(newDate).getUTCDay();
            if (day === 1) {
                Swal.fire({ icon: 'warning', title: 'é€±ä¸€å…¬ä¼‘', text: 'é¤å»³é€±ä¸€å…¬ä¼‘ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸã€‚', confirmButtonColor: '#D32F2F' });
                return;
            }
            setForm({ ...form, date: newDate });
        };

        const handleBooking = async e => {
            e.preventDefault();
            const phoneRegex = /^09\d{8}$/;
            if (!phoneRegex.test(form.phone)) {
                Swal.fire({ icon: 'error', title: 'é›»è©±è™Ÿç¢¼æ ¼å¼éŒ¯èª¤', text: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ 10 ä½æ‰‹æ©Ÿè™Ÿç¢¼ï¼Œå¿…é ˆä»¥ 09 é–‹é ­ã€‚', confirmButtonColor: '#D32F2F' });
                return;
            }
            const time = form.time;
            const isLunch = time >= '11:00' && time <= '13:00';
            const isDinner = time >= '17:00' && time <= '20:00';
            if (!isLunch && !isDinner) {
                Swal.fire({ icon: 'error', title: 'è¨‚ä½å¤±æ•—', text: 'è«‹é¸æ“‡ç‡Ÿæ¥­æ™‚æ®µï¼š11:00-13:00 æˆ– 17:00-20:00ã€‚', confirmButtonColor: '#D32F2F' });
                return;
            }
            
            setSubmitting(true);
            const res = await runGAS('booking', { ...form, lineUserId: profile?.userId });
            if (res.status === 'success') {
                if (window.liff.isInClient()) {
                    await window.liff.sendMessages([{
                        type: 'text',
                        text: `ğŸ”” è–©è«¾ç“¦è¨‚ä½ç¢ºèªï¼š\næ—¥æœŸï¼š${form.date}\næ™‚é–“ï¼š${form.time}\näººæ•¸ï¼š${form.adults}å¤§${form.children}å°\nå§“åï¼š${form.name}\næˆ‘å€‘æœƒç›¡å¿«ç‚ºæ‚¨ç¢ºèªä½ç½®ï¼`
                    }]).catch(err => console.error("Send message error", err));
                }
                Swal.fire({
                    title: 'é ç´„æˆåŠŸï¼',
                    html: 'å·²ç™¼é€è¨Šæ¯è‡³å®˜æ–¹å¸³è™Ÿä¸¦ä¿å­˜ç´€éŒ„ã€‚<br><br><b>è«‹å•éœ€è¦é å…ˆé»é¤å—ï¼Ÿ</b><br><small>(è«‹æ³¨æ„ï¼šé é»é¤æ˜¯ç‚ºæ‚¨ç¯€çœç¾å ´ç­‰å€™æ™‚é–“ï¼Œé¤é»ä¸æœƒæå‰è£½ä½œï¼Œç¾å ´ä»å¯ä¿®æ”¹)</small>',
                    icon: 'success',
                    showCancelButton: true,
                    confirmButtonText: 'å‰å¾€é»é¤',
                    cancelButtonText: 'ç¨å¾Œå†èªª',
                    confirmButtonColor: '#2c5e50',
                    cancelButtonColor: '#6e7881',
                }).then((result) => {
                    if (result.isConfirmed) {
                        onBookingSuccess(res.bookingId);
                    } else {
                        onBack();
                    }
                });
            } else {
                Swal.fire({ icon: 'error', title: 'é ç´„å¤±æ•—', text: res.message, confirmButtonColor: '#D32F2F' });
            }
            setSubmitting(false);
        };

        const NumberInput = ({ label, value, onChange, min = 0, max = 99, disabled = false }) => {
            const handleChange = (delta) => {
                const newValue = value + delta;
                if (newValue >= min && newValue <= max) {
                    onChange(newValue);
                }
            };
            return React.createElement("div", { className: "flex-1 text-center" },
                React.createElement("span", { className: "label-text" }, label),
                React.createElement("div", { className: "flex items-center justify-center gap-4 mt-2" },
                    React.createElement("button", { type: "button", onClick: () => handleChange(-1), disabled: disabled || value <= min, className: "w-8 h-8 rounded-full bg-gray-200 text-lg font-bold disabled:opacity-50" }, "-"),
                    React.createElement("span", { className: "text-xl font-bold w-8 text-center" }, value),
                    React.createElement("button", { type: "button", onClick: () => handleChange(1), disabled: disabled || value >= max, className: "w-8 h-8 rounded-full bg-gray-200 text-lg font-bold disabled:opacity-50" }, "+")
                )
            );
        };

        return React.createElement("form", { onSubmit: handleBooking, className: "p-6 space-y-6 bg-gray-50" },
            React.createElement("div", { className: "p-4 bg-white rounded-xl shadow-sm border" },
                React.createElement("h3", { className: "font-bold text-gray-700 mb-4 flex items-center gap-2" }, React.createElement(Icon, { name: "calendar", className: "w-5 h-5 text-green-600" }), "ç”¨é¤æ™‚é–“"),
                React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                    React.createElement("div", null, React.createElement("span", { className: "label-text" }, "æ—¥æœŸ"), React.createElement("input", { type: "date", className: "input-field", value: form.date, min: new Date().toISOString().split('T')[0], onChange: handleDateChange })),
                    React.createElement("div", null, React.createElement("span", { className: "label-text" }, "æ™‚é–“"), React.createElement("input", { type: "time", className: "input-field", value: form.time, onChange: e => setForm({ ...form, time: e.target.value }) }))
                )
            ),
            React.createElement("div", { className: "p-4 bg-white rounded-xl shadow-sm border" },
                React.createElement("h3", { className: "font-bold text-gray-700 mb-4 flex items-center gap-2" }, React.createElement(Icon, { name: "user", className: "w-5 h-5 text-purple-600" }), "ç”¨é¤äººæ•¸"),
                React.createElement("div", { className: "flex justify-around" },
                    React.createElement(NumberInput, { label: "å¤§äºº", value: form.adults, onChange: (v) => setForm({ ...form, adults: v }), min: 1 }),
                    React.createElement(NumberInput, { label: "å°å­©", value: form.children, onChange: (v) => setForm({ ...form, children: v }) })
                )
            ),
            React.createElement("div", { className: "p-4 bg-white rounded-xl shadow-sm border" },
                 React.createElement("h3", { className: "font-bold text-gray-700 mb-4" }, "ç”¨é¤éœ€æ±‚"),
                 React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                    React.createElement("div", null, 
                        React.createElement("span", { className: "label-text" }, "åº§ä½åå¥½"), 
                        React.createElement("select", { value: form.seating, onChange: e => setForm({ ...form, seating: e.target.value }), className: "input-field" },
                            React.createElement("option", null, "ä¸æŒ‡å®š"), React.createElement("option", null, "é çª—"), React.createElement("option", null, "åŒ…å»‚"), React.createElement("option", null, "å®‰éœè§’è½")
                        )
                    ),
                    React.createElement("div", null, 
                        React.createElement("span", { className: "label-text" }, "ç”¨é¤ç›®çš„"), 
                        React.createElement("select", { value: form.occasion, onChange: e => setForm({ ...form, occasion: e.target.value }), className: "input-field" },
                            React.createElement("option", null, "ç„¡"), React.createElement("option", null, "ç”Ÿæ—¥"), React.createElement("option", null, "ç´€å¿µæ—¥"), React.createElement("option", null, "å•†å‹™")
                        )
                    )
                 ),
                 React.createElement("div", { className: "flex justify-around items-center mt-4 pt-4 border-t" },
                    React.createElement(NumberInput, { label: "å…’ç«¥æ¤…", value: form.highChairs, onChange: (v) => setForm({ ...form, highChairs: v }), max: form.children, disabled: form.children === 0 }),
                    React.createElement("div", { className: "flex-1 text-center" },
                       React.createElement("span", { className: "label-text" }, "ç´ é£Ÿ"),
                       React.createElement("label", { className: "mt-2 inline-flex items-center cursor-pointer" },
                          React.createElement("input", { type: "checkbox", checked: form.vegetarian, onChange: (e) => setForm({...form, vegetarian: e.target.checked}), className: "sr-only peer" }),
                          React.createElement("div", { className: "relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600" })
                       )
                    )
                )
            ),
            React.createElement("div", { className: "p-4 bg-white rounded-xl shadow-sm border" },
                React.createElement("h3", { className: "font-bold text-gray-700 mb-4 flex items-center gap-2" }, React.createElement(Icon, { name: "phone", className: "w-5 h-5 text-blue-600" }), "è¯çµ¡è³‡è¨Š"),
                React.createElement("div", { className: "space-y-4" },
                    React.createElement("div", null, React.createElement("span", { className: "label-text" }, "è¯çµ¡å§“å"), React.createElement("input", { className: "input-field", required: true, value: form.name, onChange: e => setForm({ ...form, name: e.target.value }) })),
                    React.createElement("div", null, React.createElement("span", { className: "label-text" }, "è¯çµ¡é›»è©±"), React.createElement("input", { type: "tel", className: "input-field", required: true, value: form.phone, onChange: e => setForm({ ...form, phone: e.target.value }) })),
                    React.createElement("div", null, React.createElement("span", { className: "label-text" }, "ç‰¹æ®Šéœ€æ±‚å‚™è¨»"), React.createElement("textarea", { className: "input-field", rows: "2", value: form.notes, onChange: e => setForm({ ...form, notes: e.target.value }) }))
                )
            ),
            React.createElement("p", {className: "text-xs text-center text-gray-400 px-4"}, "ç‚ºç¢ºä¿æœå‹™å“è³ªï¼Œç·šä¸Šåƒ…æ¥å—40äººå…§è¨‚ä½ï¼Œè‹¥æœ‰å…¶ä»–éœ€æ±‚è«‹ä¾†é›»æ´½è©¢ã€‚"),
            React.createElement("button", { type: "submit", disabled: submitting, className: "w-full bg-[#D32F2F] text-white py-4 rounded-xl font-bold shadow-lg disabled:bg-gray-400 transition-colors" }, submitting ? "è™•ç†ä¸­..." : "ç¢ºèªé€å‡º")
        );
    };

    const MemberView = ({ member, profile, onMemberUpdate, onMemberDelete, setView }) => {
      const [isEditing, setIsEditing] = useState(false);
      const [form, setForm] = useState(member);

      const handleUpdate = async () => { /* ... (same as before) ... */ };
      const handleDelete = async () => { /* ... (same as before) ... */ };

      if (!member) { /* ... (registration form, same as before) ... */ }

      // Member View
      return React.createElement("div", { className: "p-6" },
        React.createElement("div", { className: "bg-gradient-to-br from-[#2c5e50] to-black p-6 rounded-2xl text-white shadow-xl relative overflow-hidden" },
            React.createElement("div", { className: "text-xl font-bold mb-8" }, RESTAURANT_NAME),
            React.createElement("div", { className: "flex justify-between items-end" },
                React.createElement("div", null, React.createElement("p", { className: "text-sm opacity-80" }, member.name), React.createElement("p", { className: "tracking-widest" }, member.phone)),
                React.createElement("div", { className: "text-right" }, React.createElement("p", { className: "text-[10px] opacity-60" }, "POINTS"), React.createElement("p", { className: "text-2xl font-bold" }, member.points))
            )
        ),
        React.createElement("div", { className: "mt-8 grid grid-cols-2 gap-4" },
            [
                { id: 'MY_BOOKINGS', name: 'æˆ‘çš„è¨‚ä½', icon: 'calendar' },
                { id: 'POINT_HISTORY', name: 'é»æ•¸ç´€éŒ„', icon: 'history' },
                { id: 'COUPONS', name: 'æˆ‘çš„å„ªæƒ åˆ¸', icon: 'ticket' },
                { id: 'STAMP_CARD', name: 'é›†é»å¡', icon: 'stamp' }
            ].map(btn => React.createElement("button", { key: btn.id, onClick: () => setView(btn.id), className: "bg-white p-4 rounded-xl shadow border flex flex-col items-center justify-center gap-2" },
                React.createElement(Icon, { name: btn.icon, className: "w-8 h-8 text-green-700" }),
                React.createElement("span", { className: "font-bold text-sm" }, btn.name)
            ))
        ),
        React.createElement("div", { className: "mt-6 bg-white rounded-xl p-4 border space-y-3" },
            isEditing ?
            React.createElement(React.Fragment, null, 
                /* ... (edit form, same as before) ... */
            ) :
            React.createElement("div", { className: "flex justify-end gap-2" },
                React.createElement("button", { onClick: () => setIsEditing(true), className: "flex items-center gap-1 text-sm bg-gray-100 px-3 py-1 rounded-full" }, React.createElement(Icon, {name:"edit", className:"w-4 h-4"}), "ä¿®æ”¹è³‡æ–™"),
                React.createElement("button", { onClick: handleDelete, className: "flex items-center gap-1 text-sm bg-red-50 text-red-600 px-3 py-1 rounded-full" }, React.createElement(Icon, {name:"trash", className:"w-4 h-4"}), "åˆªé™¤æœƒå“¡")
            )
        )
      );
    };

    const MyBookingsView = ({ profile }) => {
        const [bookings, setBookings] = useState([]);
        const [loading, setLoading] = useState(true);
        useEffect(() => {
            runGAS('getUserBookings', { lineUserId: profile.userId })
                .then(res => {
                    if (res.status === 'success') setBookings(res.bookings.reverse());
                })
                .finally(() => setLoading(false));
        }, [profile.userId]);

        if (loading) return React.createElement("p", {className: "text-center p-8"}, "è®€å–ä¸­...");
        if (bookings.length === 0) return React.createElement("p", {className: "text-center text-gray-500 p-8"}, "æ‚¨ç›®å‰æ²’æœ‰ä»»ä½•è¨‚ä½ç´€éŒ„ã€‚");

        return React.createElement("div", {className: "p-4 space-y-4"},
            bookings.map((b, i) => React.createElement("div", {key: i, className: "bg-white p-4 rounded-lg shadow border"},
                React.createElement("p", {className: "font-bold text-lg"}, `${new Date(b.é ç´„æ—¥æœŸ).toLocaleDateString()} ${b.é ç´„æ™‚é–“}`),
                React.createElement("p", {className: "text-sm text-gray-600"}, `äººæ•¸ï¼š${b.å¤§äºº}å¤§ ${b.å°å­©}å°`),
                b.é é»é¤ && React.createElement("p", {className: "text-xs text-green-700 mt-1 pt-1 border-t"}, `é é»ï¼š${b.é é»é¤.replace(/;/g, ', ')}`)
            ))
        );
    };

    const PointHistoryView = ({ profile }) => {
        const [history, setHistory] = useState([]);
        const [loading, setLoading] = useState(true);
        useEffect(() => {
            runGAS('getPointHistory', { lineUserId: profile.userId })
                .then(res => {
                    if (res.status === 'success') setHistory(res.history.reverse());
                })
                .finally(() => setLoading(false));
        }, [profile.userId]);
        
        if (loading) return React.createElement("p", {className: "text-center p-8"}, "è®€å–ä¸­...");
        if (history.length === 0) return React.createElement("p", {className: "text-center text-gray-500 p-8"}, "æ‚¨æ²’æœ‰ä»»ä½•é»æ•¸ç´€éŒ„ã€‚");

        return React.createElement("div", {className: "p-4"},
            history.map((h, i) => React.createElement("div", {key: i, className: "flex justify-between items-center p-3 border-b"},
                React.createElement("div", null,
                    React.createElement("p", {className: "font-bold"}, h.èªªæ˜),
                    React.createElement("p", {className: "text-xs text-gray-400"}, new Date(h.æ™‚é–“).toLocaleString())
                ),
                React.createElement("p", {className: `font-bold text-lg ${h.é»æ•¸è®ŠåŒ– > 0 ? 'text-green-600' : 'text-red-600'}`}, `${h.é»æ•¸è®ŠåŒ– > 0 ? '+' : ''}${h.é»æ•¸è®ŠåŒ–}`)
            ))
        );
    };

    const CouponsView = ({ profile }) => {
        const [coupons, setCoupons] = useState([]);
        const [loading, setLoading] = useState(true);
        useEffect(() => { /* fetch coupons */ setLoading(false); }, []);

        if (loading) return React.createElement("p", {className: "text-center p-8"}, "è®€å–ä¸­...");
        
        // Mock data for now
        const mockCoupons = [
            { title: 'ç”Ÿæ—¥8æŠ˜åˆ¸', desc: 'é™ç”Ÿæ—¥ç•¶æœˆä½¿ç”¨ä¹™æ¬¡', expiry: '2024-12-31', status: 'æœªä½¿ç”¨' },
            { title: 'è–¯æ¢å…Œæ›åˆ¸', desc: 'æ¶ˆè²»æ»¿$500å³å¯ä½¿ç”¨', expiry: '2024-08-31', status: 'æœªä½¿ç”¨' }
        ];

        if (mockCoupons.length === 0) return React.createElement("p", {className: "text-center text-gray-500 p-8"}, "æ‚¨ç›®å‰æ²’æœ‰å¯ç”¨çš„å„ªæƒ åˆ¸ã€‚");
        
        return React.createElement("div", {className: "p-4 space-y-4"},
            mockCoupons.map((c, i) => React.createElement("div", {key: i, className: "bg-yellow-50 border border-yellow-200 p-4 rounded-lg shadow flex items-center gap-4"},
                React.createElement(Icon, {name: 'ticket', className: 'w-10 h-10 text-yellow-500'}),
                React.createElement("div", null, 
                    React.createElement("p", {className: "font-bold text-yellow-800"}, c.title),
                    React.createElement("p", {className: "text-sm text-gray-600"}, c.desc),
                    React.createElement("p", {className: "text-xs text-gray-400 mt-1"}, `æœ‰æ•ˆæœŸé™ï¼š${c.expiry}`)
                )
            ))
        );
    };

    const StampCardView = ({ profile }) => {
        const [stamps, setStamps] = useState(0);
        const [loading, setLoading] = useState(true);
        useEffect(() => { /* fetch stamps */ setLoading(false); }, []);
        
        const totalStamps = 10;
        const currentStamps = 6; // Mock data

        if (loading) return React.createElement("p", {className: "text-center p-8"}, "è®€å–ä¸­...");

        return React.createElement("div", {className: "p-6"},
            React.createElement("div", {className: "bg-white p-4 rounded-xl shadow border"},
                React.createElement("h3", {className: "font-bold text-center mb-4"}, "æ¶ˆè²»é›†é»å¡"),
                React.createElement("p", {className: "text-xs text-center text-gray-500 mb-6"}, "å–®ç­†æ¶ˆè²»æ»¿ $300 å³å¯ç´¯ç© 1 é»ï¼Œé›†æ»¿ 10 é»å¯å…Œæ›ã€Œä¸»å»šç‰¹è£½é¤é»ã€ä¹™ä»½ï¼"),
                React.createElement("div", {className: "grid grid-cols-5 gap-4"},
                    [...Array(totalStamps)].map((_, i) => React.createElement("div", {key: i, className: `w-12 h-12 rounded-full flex items-center justify-center ${i < currentStamps ? 'bg-green-500' : 'bg-gray-200'}`},
                        i < currentStamps && React.createElement(Icon, {name: 'star', className: 'w-8 h-8 text-white fill-current'})
                    ))
                ),
                React.createElement("p", {className: "font-bold text-center mt-6"}, `ç›®å‰é»æ•¸ï¼š${currentStamps} / ${totalStamps}`)
            )
        );
    };

    const PreorderView = ({ bookingId, onBack }) => {
        const menuData = {
          categories: [
            { name: "ä¸»å»šæ¨è–¦", items: [{ n: "æ¥µå“X.Oé†¬æµ·é®®ç¾©å¤§åˆ©éºµ", p: 250, isSpecial: true }, { n: "å¢¨é­šæ±æµ·é®®å¢¨é­šéºµ", p: 260, isSpecial: true, allergens: "æµ·é®®ã€éº©è³ª" }] },
            { name: "PIZZA 7å‹", items: [{ n: "è•ƒèŒ„ç”°åœ’æ™‚è”¬æŠ«è–©(è›‹å¥¶ç´ )", p: 170 }, { n: "å¤å¨å¤·è¦ä»æŠ«è–©", p: 200, allergens: "è¦ã€éº©è³ª" }] },
            // ... other categories and items ...
          ]
        };
        // ... rest of the PreorderView logic ...
        const showAllergens = (allergens) => {
            Swal.fire({ title: 'éæ•åŸè³‡è¨Š', html: `æœ¬ç”¢å“å¯èƒ½å«æœ‰ï¼š<br><b>${allergens}</b>`, icon: 'warning', confirmButtonColor: '#2c5e50' });
        };
        
        return React.createElement("div", { className: "flex h-full" },
            // ... (left side category list) ...
            React.createElement("div", { className: "w-3/4 p-4 overflow-y-auto" },
                React.createElement("div", { className: "space-y-2" },
                    menuData.categories.find(c => c.name === activeCategory).items.map(item => React.createElement("div", {
                        key: item.n, className: "flex justify-between items-center bg-white p-3 rounded-lg border"
                    }, 
                        React.createElement("div", null, 
                            React.createElement("p", { className: "font-bold flex items-center gap-2" }, 
                                item.n,
                                item.isSpecial && React.createElement("span", { className: "text-xs bg-red-500 text-white px-2 py-0.5 rounded-full" }, "æ¨è–¦"),
                                item.allergens && React.createElement("button", { onClick: () => showAllergens(item.allergens) }, React.createElement(Icon, { name: "info", className: "w-5 h-5 text-blue-500" }))
                            ),
                            React.createElement("p", { className: "text-sm text-gray-500" }, `$${item.p}`)
                        ),
                        React.createElement("button", { onClick: () => addToCart(item), className: "bg-green-100 text-green-800 font-bold px-3 py-1 rounded-full text-sm" }, "åŠ å…¥")
                    ))
                )
            ),
            // ... (cart view)
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</head>
<body>
  <div id="root"></div>
</body>
</html>